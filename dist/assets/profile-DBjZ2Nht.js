const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/error-alert-Bbw5xTAM.js","assets/mui-vendor-CW2_5rLd.js","assets/react-vendor-DLlvbPZt.js","assets/error-alert-DdB8HbXB.css"])))=>i.map(i=>d[i]);
import{j as e}from"./mui-vendor-CW2_5rLd.js";import{r as c}from"./react-vendor-DLlvbPZt.js";import{B as P,A as i,_ as T,e as v,d as M,u as H,b as $}from"./index-lzanjXxa.js";import"./redux-vendor-BvN4x8k-.js";const F="_profile_uzobx_1",G={profile:F},I="_form_jiy66_1",z="_control_jiy66_13",D="_action_jiy66_55",L="_change_buttons_jiy66_63",m={form:I,control:z,action:D,change_buttons:L},W=c.lazy(()=>T(()=>import("./error-alert-Bbw5xTAM.js"),__vite__mapDeps([0,1,2,3]))),k=g=>{const f=c.useRef(null),n=c.useRef(null),s=c.useRef(null),[t,d]=c.useState(!1),[p,_]=c.useState(!1),[y,u]=c.useState(!1),[h,r]=c.useState({error_state:!1,error_severity:"",message:""}),A=g.userName,N=()=>{u(!0),r(o=>({...o,error_state:!1,error_severity:"",message:""}))},E=o=>{o.currentTarget.value.length<i.USERNAME_MIN||o.currentTarget.value===void 0?(u(!1),r(a=>({...a,error_state:!0,error_severity:"warning",message:i.CHANGE_USER_TOO_FEW}))):o.currentTarget.value.length>i.USERNAME_MAX?(u(!1),r(a=>({...a,error_state:!0,error_severity:"warning",message:i.CHANGE_USER_TOO_MANY}))):o.currentTarget.value===A?(u(!1),r(a=>({...a,error_state:!0,error_severity:"warning",message:i.CHANGE_USER_UNIQUE}))):N()},S=o=>{var j,x;const a=(j=f.current)==null?void 0:j.value,l=(x=n.current)==null?void 0:x.value;a.length<i.PASSWORD_MIN||l.length<i.PASSWORD_MIN?(u(!1),r(w=>({...w,error_state:!0,error_severity:"warning",message:i.CHANGE_PASS_TOO_FEW}))):a.length>i.PASSWORD_MAX||l.length>i.PASSWORD_MAX?(u(!1),r(w=>({...w,error_state:!0,error_severity:"warning",message:i.CHANGE_PASS_TOO_MANY}))):a&&l&&a===l?(u(!1),r(w=>({...w,error_state:!0,error_severity:"warning",message:i.CHANGE_PASS_UNIQUE}))):a.length!==l.length?(u(!1),r(w=>({...w,error_state:!0,error_severity:"warning",message:i.CHANGE_PASS_LENGTH}))):N()},U=o=>{var l;o.preventDefault();const a=(l=s.current)==null?void 0:l.value;a&&(g.onChangeUsername({newUsername:a}),C())},b=o=>{var j,x;o.preventDefault();const a=(j=f.current)==null?void 0:j.value,l=(x=n.current)==null?void 0:x.value;!a||!l||(g.onChangePassword({oldPassword:a,newPassword:l}),C())},C=()=>{N(),d(!1),_(!1)},R=()=>{N(),d(o=>!o),_(!1)},O=()=>{N(),_(o=>!o),d(!1)};return e.jsxs(c.Fragment,{children:[e.jsxs("div",{className:m.change_buttons,children:[e.jsx(P,{disabled:t,onClick:R,variant:"contained",color:"primary",children:"User Name"}),e.jsx(P,{disabled:p,onClick:O,variant:"contained",color:"primary",children:"Password"})]}),p&&e.jsx("div",{className:m.form_container,children:e.jsxs("form",{className:m.form,onSubmit:b,children:[e.jsxs("div",{className:m.control,children:[e.jsx("label",{htmlFor:"new-password",children:"New Password"}),e.jsx("input",{autoComplete:"New Password",type:"password",id:"new-password",ref:n,onChange:S})]}),e.jsxs("div",{className:m.control,children:[e.jsx("label",{htmlFor:"old-password",children:"Old Password"}),e.jsx("input",{autoComplete:"New User Name",type:"password",id:"old-password",ref:f,onChange:S})]}),e.jsx("div",{className:m.action,children:e.jsx(P,{disabled:!y,variant:"contained",color:"secondary",type:"submit",children:"Change Password"})})]})}),t&&e.jsx("div",{className:m.form_container,children:e.jsxs("form",{className:m.form,onSubmit:U,children:[e.jsxs("div",{className:m.control,children:[e.jsx("label",{htmlFor:"new-username",children:"User Name"}),e.jsx("input",{defaultValue:A,type:"text",id:"new-password",ref:s,onChange:E})]}),e.jsx("div",{className:m.action,children:e.jsx(P,{disabled:!y,type:"submit",variant:"contained",color:"secondary",children:"Change User Name"})})]})}),h.error_state&&e.jsx(c.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(W,{error_severity:`${h.error_severity?h.error_severity:"error"}`,children:e.jsx("div",{children:h.message})})})]})},B=i,V=async(g,f)=>{let n;try{if(n=await fetch("https://www.snipbee.com/api/auth/change-password",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify(f)}),n.status===404)throw new Error(`${n.url} Not Found.`);if(n.status===401)throw new Error("Unauthorized")}catch(t){return{error:v(t)}}let s;try{if(s=await n.json(),s===null)return{error:`${B.CHANGE_PASS_ERROR}`}}catch(t){return{error:v(t)}}return s.error?{error:s.error}:s},X=i,J=async(g,f)=>{let n;try{if(n=await fetch("https://www.snipbee.com/api/auth/change-username",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify(f)}),n.status===404)throw new Error(`${n.url} Not Found.`);if(n.status===401)throw new Error("Unauthorized")}catch(t){return{error:v(t)}}let s;try{if(s=await n.json(),s===null)return{error:`${X.CHANGE_USER_ERROR}`}}catch(t){return{error:v(t)}}return s.error?{error:s.error}:s},Q=()=>{const{authContext:g,setAuthContext:f}=c.useContext(M),{success:n,token:s,details:t,onLogout:d}=g,p=H(),_=c.useCallback(h=>{p($.showNotification({status:"error",title:"Error!",message:h}))},[p]),y=async h=>{if(s)try{const r=await V(s,h);if(r.error){_(`${r.error}`);return}r.success}catch(r){_(`${r}`);return}},u=async h=>{if(s)try{const r=await J(s,h);if(r.error){_(`${r.error}`);return}if(r.error==="Unauthorized"){d&&d();return}r.success&&f(A=>({...A,success:r.success,details:r.details,loading:!1}))}catch(r){_(`${r}`);return}};return e.jsxs(c.Fragment,{children:[!n&&e.jsx("p",{children:"Loading..."}),n&&!s&&e.jsx("p",{children:"Unauthorized"}),n&&s&&e.jsxs("section",{className:G.profile,children:[e.jsx("h2",{children:t==null?void 0:t.username}),e.jsx("h3",{children:t==null?void 0:t.email}),e.jsx(k,{userName:t==null?void 0:t.username,onChangePassword:y,onChangeUsername:u})]})]})},ee=()=>e.jsx(Q,{});export{ee as default};
