import{j as s,C as J,a as K,u as oe,F as T,z as q,G as ae,V as ie,E as ce}from"./mui-vendor-CW2_5rLd.js";import{r as e,m as le,u as de}from"./react-vendor-DLlvbPZt.js";import{e as E,A as k,u as ue,b as fe,c as he,s as xe,L as pe,d as we}from"./index-lzanjXxa.js";import{c as x,m as me,V as ge,b as Se,u as _e,g as ve}from"./getNotebook-DMbyxFbx.js";import{F as Ee}from"./footer-DmwuNB4o.js";import"./redux-vendor-BvN4x8k-.js";import"./markdown-vendor-BgXz8MM8.js";const be="_view_container_108py_1",Ne={view_container:be};let R=!1,_,v;const je=()=>{_=document.querySelector("#edit"),v=document.querySelector("#view"),Ce()},G=(i,r)=>{if(i!==null&&r!==null){let a=r.scrollHeight-r.clientHeight,o=i.scrollTop/(i.scrollHeight-i.clientHeight)*100,n=a*(o/100);i.onscroll=c=>{var l=R;R=!1,!l&&(R=!0,r.scrollTop=n)}}},Ce=()=>{v!==null&&_!==null&&_.addEventListener("scroll",()=>{G(_,v)}),v!==null&&_!==null&&v.addEventListener("scroll",()=>{G(v,_)})},Te=i=>{const r=i.visible,a=i.loadedText,o=i.splitScreen,n=i.passUpdatedViewText,c=e.useRef(null);e.useEffect(()=>{c.current&&c.current.innerText!==n&&(c.current.innerText=n)},[n]),e.useEffect(()=>{a===""&&c.current&&c.current.focus(),a&&c.current&&(c.current.innerText=a)},[c,a]);const l=d=>{i.updateViewText(d.currentTarget.innerText)};return s.jsx(e.Fragment,{children:s.jsx("div",{id:"edit",className:`edit ${x.editnote_box} ${r?x.editting:o?x.show:x.hide}`,children:s.jsx(J,{children:s.jsx(K,{children:s.jsx("article",{className:"viewnote_content editor",children:s.jsx("div",{ref:c,contentEditable:r||o,className:`viewnote_content ${x.editable}`,onInput:d=>l(d),"data-placeholder":"Start writing..."})})})})})})};window.Buffer=window.Buffer||Se.Buffer;const ye=i=>{const r=i.splitScreen,a=i.visible,{content:o}=me(i.viewText),[n,c]=e.useState(""),[l,d]=e.useState(r),[b,I]=e.useState(!1),V=u=>{i.updatedViewText(u)};return e.useEffect(()=>(o!==n&&c(o),I(!0),()=>{}),[o,n]),e.useEffect(()=>{d(r)},[r]),s.jsx(e.Fragment,{children:s.jsx("div",{id:"view",className:`view ${l?`view_split ${x.show}`:""} ${x.editnote_box} ${a?x.show:x.hide}`,children:s.jsx(J,{sx:{width:"100%"},children:s.jsx(K,{children:s.jsx("article",{id:"viewnote_id",className:`viewnote_content viewer ${x.viewnote_content}`,children:b?s.jsx(ge,{splitScreen:r,viewText:n,updatedViewText:V,disableLinks:!1}):s.jsx(oe,{variant:"rounded",height:50})})})})})})},$e=e.memo(ye),ke=k,Ie=async(i,r,a)=>{let o;try{if(o=await fetch(`https://www.snipbee.com/api/data/notebook/${r}/${a}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}}),o.status===404)throw new Error(`${o.url} Not Found.`)}catch(c){return{error:E(c)}}let n;try{if(n=await o.json(),n===null)return{error:`${ke.NOTE_ERROR}`}}catch(c){return{error:E(c)}}return n.error?{error:n.error}:n},Ve=k,Me=async(i,r)=>{let a;try{if(a=await fetch("https://www.snipbee.com/api/data/create-note",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)}),a.status===404)throw new Error(`${a.url} Not Found.`)}catch(n){return{error:E(n)}}let o;try{if(o=await a.json(),o===null)return{error:`${Ve.NOTE_CREATE_ERROR}`}}catch(n){return{error:E(n)}}return o.error?{error:o.error}:o},Ae=k,Le=async(i,r,a,o)=>{let n;const c={notebookID:r,noteID:a,note:o};try{if(n=await fetch("https://www.snipbee.com/api/data/save-note",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(c)}),n.status===404)throw new Error(`${n.url} Not Found.`)}catch(d){return{error:E(d)}}let l;try{if(l=await n.json(),l===null)return{error:`${Ae.NOTE_SAVE_ERROR}`}}catch(d){return{error:E(d)}}return l.error?{error:l.error}:l},Oe=()=>e.useContext(we),qe=()=>{const{authContext:i}=Oe(),{token:r}=i,{notebookId:a,noteId:o}=le(),n=ue(),c=de();let l=!1;const{width:d,height:b}=_e(),[I,V]=e.useState(""),u=e.useCallback(t=>{n(fe.showNotification({status:"error",title:"Error!",message:t}))},[n]);e.useEffect(()=>{fetch("/md/welcome_markdown.md").then(t=>t.text()).then(t=>V(t))},[]),e.useEffect(()=>{d<k.SPLITSCREEN_MINIMUM_WIDTH?(M(!1),z(!0)):z(!1)},[d,b]),e.useEffect(()=>{setTimeout(()=>{je()},500)},[]),o==="create-note"&&(l=!0);const[f,F]=e.useState(""),[Q,X]=e.useState(""),[g,N]=e.useState(!1),[y,j]=e.useState(!1),[h,Y]=e.useState(l),[S,M]=e.useState(!1),[P,z]=e.useState(!1),[p,Z]=e.useState(l),[H,B]=e.useState(""),[ee,te]=e.useState(""),[w,C]=e.useState(!1),[D,$]=e.useState(!1);e.useEffect(()=>{(async()=>{if(!p&&a&&o&&o!=="create-note"&&!w&&r){C(!1);try{const t=await Ie(r,a,o);if(C(!0),t.error){u(`${t.error}`);return}t.success&&(F(t.note.note),X(t.note.note),B(t.note.note),C(!0))}catch(t){u(`${t}`),C(!0);return}}else C(!0)})(),(async()=>{if(!D&&r&&a){$(!1);try{const t=await ve(r,a);if($(!0),t.error){u(`${t.error}`);return}t.success&&n(he.editChange({message:t.notebook}))}catch(t){u(`${t}`),$(!0);return}}})()},[r,n,a,o,p,w,D,u]);const A=e.useCallback(()=>{Y(!h)},[h]),se=e.useCallback(()=>{M(!S)},[S]),L=e.useCallback(async()=>{if(r&&a&&o&&f){let t;try{if(t=await Le(r,a,o,f),t.error){u(`${t.error}`);return}if(t.success)return N(!1),j(!1),B(f),h&&A(),t}catch(m){u(`${m}`);return}}},[h,o,a,A,f,r,u]);e.useEffect(()=>{if(y&&g&&(h||g)&&!p)return(async()=>{await L(),j(!1),N(!1)})(),()=>{}},[y,g,h,p,L]),e.useEffect(()=>{y&&n(xe.showSnack({status:!0,message:"Note Saved"}))},[y,n]);const re=()=>{P||M(!0),O(I)},ne=async()=>{if(r&&a&&f){j(!1);const t={notebookId:a,note:f};try{const m=await Me(r,t);if($(!0),m.error){u(`${m.error}`);return}m.success&&(Z(!1),N(!1),j(!1),c(`/notebook/${a}`))}catch(m){u(`${m}`);return}}},U=e.useCallback(t=>{N(t!==H)},[H]),O=e.useCallback(t=>{U(t),F(t),te(t)},[U]),W=e.useCallback(()=>{g&&!p&&j(!0)},[g,p]);return e.useEffect(()=>{const t=()=>{W()};return window.addEventListener("popstate",t),()=>{window.removeEventListener("popstate",t)}},[W]),s.jsxs(e.Fragment,{children:[(!w||r===null)&&s.jsx(pe,{}),s.jsx("div",{className:"page_scrollable_header_breadcrumb_footer",children:w&&r!==null&&s.jsxs("div",{className:Ne.view_container,id:"view_container",children:[s.jsx(Re,{visible:!h,splitScreen:S,viewText:f,updatedViewText:O}),s.jsx(Fe,{visible:h,splitScreen:S,loadedText:Q,updateViewText:O,passUpdatedViewText:ee})]})}),s.jsxs(Ee,{children:[w&&f.length>0&&!p&&g&&s.jsxs(T,{variant:"extended",color:"secondary",size:"medium",onClick:L,children:[s.jsx(q,{sx:{mr:1}}),"Save Note"]}),w&&f.length>0&&p&&s.jsxs(T,{variant:"extended",color:"secondary",size:"medium",onClick:ne,children:[s.jsx(q,{sx:{mr:1}}),"Create Note"]}),w&&f.length===0&&p&&s.jsxs(T,{variant:"extended",color:"primary",size:"medium",onClick:re,className:"example_button",children:[s.jsx(ae,{sx:{mr:0}}),"Example"]}),w&&!S&&s.jsxs(T,{variant:"extended",color:"secondary",size:"medium",onClick:A,children:[h?s.jsx(ie,{sx:{mr:1}}):s.jsx(ce,{sx:{mr:1}}),h?"View":"Edit"]}),w&&!P&&s.jsx(T,{variant:"extended",color:"primary",size:"medium",onClick:se,className:"split_screen_button",children:S?s.jsx("span",{className:"split_screen_icon",children:s.jsx("img",{src:"/images/split_screen_icon_single.png",alt:"split screen icon",width:"30",height:"30"})}):s.jsx("span",{className:"split_screen_icon",children:s.jsx("img",{src:"/images/split_screen_icon_double.png",alt:"split screen icon",width:"30",height:"30"})})})]})]})},Re=$e,Fe=Te;export{qe as default};
